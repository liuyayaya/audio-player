!function(){"use strict";function t(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function i(e,n){for(var t=0;t<n.length;t++){var i=n[t];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function e(e,n,t){return n&&i(e.prototype,n),t&&i(e,t),e}function d(e){var n=Math.floor(e/60/60),t=Math.floor((e-60*n*60)/60),i=e-60*n*60-60*t;return"".concat(0<n?n+":":"").concat(0<t?10<=t?t:"0"+t:"00",":").concat(0<i?10<=i?i:"0"+i:"00")}var r=function(){function n(e){t(this,n),this.scene=null,this.camera=null,this.renderer=null,this.allGeo=[],this.canvasCtx=null,this.sceneDom=e.sceneDom,this.effect=e.effect,this.init()}return e(n,[{key:"create2dSence",value:function(){var e=this.sceneDom.getAttribute("data-width")||this.sceneDom.offsetWidth,n=this.sceneDom.getAttribute("data-height")||this.sceneDom.offsetHeight,t=document.createElement("canvas");this.canvasCtx=t.getContext("2d"),t.width=e,t.height=n,t.style.backgroundColor="#FF0000",this.sceneDom.appendChild(t)}},{key:"create3dSence",value:function(){var e=this.sceneDom.getAttribute("data-width")||this.sceneDom.offsetWidth,n=this.sceneDom.getAttribute("data-height")||this.sceneDom.offsetHeight;this.scene=new THREE.Scene,this.camera=new THREE.PerspectiveCamera(60,e/n,.1,3e3);var t=new THREE.AxisHelper(n);this.renderer=new THREE.WebGLRenderer,this.camera.position.set(-10,1e3,400),this.camera.lookAt(this.scene.position),this.renderer.setSize(e,n),this.renderer.setClearColor(new THREE.Color(10079436)),this.sceneDom.appendChild(this.renderer.domElement),this.scene.add(t),this.renderer.render(this.scene,this.camera);var i=new THREE.PlaneGeometry(e,n),o=new THREE.MeshBasicMaterial({color:11184810}),r=new THREE.Mesh(i,o);r.rotation.x=-45,this.scene.add(r),this.createBarList(this.scene),this.renderer.render(this.scene,this.camera)}},{key:"createBarList",value:function(e){for(var n=-16;n<16;n++){var t=new THREE.BoxGeometry(10,10,10),i=new THREE.MeshBasicMaterial({color:16711680}),o=new THREE.Mesh(t,i);o.name="bar",o.position.set(30*n,0,0),this.allGeo.push(o),e.add(o)}}},{key:"renderScene",value:function(e){switch(this.effect){case"2d":this.render2d(e);break;case"3d":this.render3d(e)}}},{key:"render2d",value:function(e){var n=this.sceneDom.getAttribute("data-width")||this.sceneDom.offsetWidth,t=this.sceneDom.getAttribute("data-height")||this.sceneDom.offsetHeight;this.canvasCtx.clearRect(0,0,n,t);for(var i=0;i<e.length;i++)this.canvasCtx.fillRect(15*i,t-e[i],10,t)}},{key:"render3d",value:function(e){for(var n=0;n<this.allGeo.length;n++)this.allGeo[n].scale.y=e[n];this.renderer.render(this.scene,this.camera)}},{key:"init",value:function(){switch(this.effect){case"2d":this.create2dSence();break;case"3d":this.create3dSence()}}}]),n}();new(function(){function n(e){t(this,n),this.audioId=e.audioId,this.audioConfig={},this.audioCtx=null,this.audioAnalyser=null,this.audioConfig.audioId=e.audioId,this.audioConfig.width=e.width,this.audioConfig.height=e.height,this.audioConfig.effect=e.effect,this.audio=document.getElementById(this.audioConfig.audioId),this.audio.setAttribute("style","display: none;"),this.audioPlayerDom=null,this.isEnd=!1,this.reqstAnmtId=0,this.audioScene=null,this.createAudio(),this.createAudioContent()}return e(n,[{key:"createAudio",value:function(){var e=this.audio.parentNode,n=this.createAudioControl(),t='<div class="audio-player" id="audioPlayer-'.concat(this.audioConfig.audioId,'">\n                <div class="audio-content" style="width: ').concat(this.audioConfig.width,"px; height: ").concat(this.audioConfig.height,'px;"></div>\n                ').concat(n,"\n            </div>"),i=(new DOMParser).parseFromString(t,"text/html").querySelector(".audio-player");this.audioPlayerDom=i,e.insertBefore(i,this.audio),this.audioPlayerDom.insertBefore(this.audio,this.audioPlayerDom.querySelector(".audio-content")),this.initEvent();var o=this.audioPlayerDom.querySelector(".audio-content");this.audioScene=new r({sceneDom:o,effect:this.audioConfig.effect})}},{key:"createAudioControl",value:function(){return' \n            <div class="audio-control">\n                <div class="audio-control_btn j_audio_play"></div>\n                <div class="audio-control_progress">\n                    <input class="audio-control_progress-input" type="range" value="0" max="100" mmin="0" step="0.1"/>\n                </div>\n                <div class="audio-control_time">\n                    <span class="audio-control_time-current j_audioPlayer_current">00:00</span>\n                    <span>/</span>\n                    <span class="audio-control_time-all j_audioPlayer_duration">00:00</span>\n                </div>\n            </div>'}},{key:"createAudioContent",value:function(){var e=new(window.AudioContext||window.webkitAudioContext),n=e.createAnalyser();n.fftSize=64,e.createMediaElementSource(this.audio).connect(n),n.connect(e.destination);var t=n.frequencyBinCount,i=new Uint8Array(t);n.getByteFrequencyData(i),this.audioAnalyser=n,this.audioCtx=e}},{key:"renderProgress",value:function(){var e=this,n=parseInt(this.audio.currentTime),t=parseInt(this.audio.duration),i=(n/t*100).toFixed(1),o=this.audioPlayerDom.querySelector(".audio-control_progress input"),r=this.audioPlayerDom.querySelector(".j_audioPlayer_current"),a=this.audioAnalyser.frequencyBinCount,s=new Uint8Array(a);n<t?(r.innerHTML=d(n),o.setAttribute("value",i),this.audioAnalyser.getByteFrequencyData(s),this.audioScene.renderScene(s),this.reqstAnmtId=requestAnimationFrame(function(){e.renderProgress()})):cancelAnimationFrame(this.reqstAnmtId)}},{key:"changeProgress",value:function(){}},{key:"initData",value:function(){this.audio.addEventListener("durationchange",function(){this.audioPlayerDom.querySelector(".j_audioPlayer_duration").innerHTML=this.audio.duration})}},{key:"initEvent",value:function(){var i=this,o=this.audioPlayerDom.querySelector(".audio-control_btn");document.body.addEventListener("click",function(e){var n=e||window.event,t=n.target||n.srcElement;t.classList.contains("j_audio_play")&&(o.classList.contains("play")?(i.audio.pause(),cancelAnimationFrame(i.reqstAnmtId)):i.audioCtx.resume().then(function(){i.audioPlayerDom.querySelector(".j_audioPlayer_duration").innerHTML=d(parseInt(i.audio.duration)),i.audio.play(),i.renderProgress()}),o.classList.toggle("play")),t.classList.contains("audio-control_progress-input")}),document.body.addEventListener("change",function(e){var n=e||window.event;(n.target||n.srcElement).classList.contains("audio-control_progress-input")&&alert("channge")})}}]),n}())({audioId:"myMusic",effect:"2d",width:800,height:500});!function(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===t&&i.firstChild?i.insertBefore(o,i.firstChild):i.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}("@charset \"UTF-8\";\nbody {\n  background: #ffffff;\n  padding: 0;\n  margin: 0; }\n\n.audio-player {\n  /*  padding: 200px; */\n  font-size: 0;\n  position: relative;\n  display: inline-block;\n  /* background: url(../../assets/bg.png) no-repeat */ }\n\n.audio-content {\n  display: inline-block;\n  font-size: 0;\n  line-height: 1;\n  color: #ffffff; }\n\n.audio-control {\n  color: #ffffff;\n  font-size: 14px;\n  padding: 1em;\n  display: flex;\n  align-items: center;\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  background: rgba(0, 0, 0, 0.3); }\n  .audio-control_btn {\n    width: 3em;\n    height: 3em;\n    border-radius: 50%;\n    background: url(../../assets/icon-play.png) no-repeat center center;\n    background-size: 100% auto; }\n    .audio-control_btn.play {\n      background: url(../../assets/icon-pause.png) no-repeat center center;\n      background-size: 100% auto; }\n  .audio-control_progress {\n    flex: 1;\n    box-sizing: border-box;\n    padding: 0 0.5em;\n    position: relative;\n    /* 去除获取焦点时的边框 */\n    /* 轨道背景 */\n    /* 轨道 */ }\n    .audio-control_progress input[type=\"range\"]:focus {\n      outline: none; }\n    .audio-control_progress input[type=\"range\"] {\n      outline: none;\n      /*去掉点击时出现的外边框*/\n      -webkit-appearance: none;\n      -moz-appearance: none;\n      appearance: none;\n      /*这三个是去掉那条线原有的默认样式，划重点！！*/\n      width: 100%;\n      height: 10px;\n      border-radius: 15px; }\n    .audio-control_progress input[type='range']::-webkit-slider-runnable-track {\n      background-color: #eee;\n      border-radius: 0.5em; }\n    .audio-control_progress input[type='range']::-moz-range-track {\n      background-color: #eee;\n      border-radius: 0.5em; }\n    .audio-control_progress input[type=\"range\"]::-ms-track {\n      color: transparent;\n      background-color: #eee;\n      border-radius: 0.5em; }\n    .audio-control_progress input[type='range']::-webkit-slider-thumb {\n      -webkit-appearance: none;\n      height: 10px;\n      width: 10px;\n      border-radius: 8px;\n      background: #f8a015;\n      cursor: pointer; }\n    .audio-control_progress input[type='range']::-moz-range-thumb {\n      height: 10px;\n      width: 10px;\n      border-radius: 8px;\n      background: #f8a015;\n      cursor: pointer; }\n    .audio-control_progress input[type=\"range\"]::-moz-range-progress {\n      height: 10px;\n      background: #2e9cfb;\n      border-radius: 15px; }\n    .audio-control_progress input[type='range']::-ms-thumb {\n      height: 10px;\n      width: 10px;\n      border-radius: 8px;\n      background: #f8a015;\n      cursor: pointer; }\n    .audio-control_progress input[type=range]::-ms-fill-lower {\n      /*进度条已填充的部分*/\n      background: #2e9cfb; }\n    .audio-control_progress input[type=range]::-ms-fill-upper {\n      /*进度条未填充的部分*/\n      background: #606060; }\n")}();
